# 区块链+边缘计算技术白皮书2020

## 区块链特性

分布式是技术基础，防篡改保证了数据的稳定性和可靠性，透明性多方共识保证了数据的可验证和可信性，去中心化信任是区块链技术特征的自然结果，确保了价值能够高效、透明、安全、可信地存储和传递。

## 区块链应用领域
区块链在更多产业领域得到应用：数字金融，数字经济，数字身份，产业协同，社会民生，智慧城市，智慧政务

## 边缘计算定义
边缘计算在靠近用户的地方提供计算、存储、网络等基础设施，通过在该基础设施上部署和运行应用，为用户就近提供边缘云服务。
相较传统云计算的集中部署，边缘计算解决了通信时延长、汇聚流量大问题，为低时延和高带宽的业务提供了更好支持。

## 新型云架构计算
边缘云+中心云

## 区块链为边缘计算提供信任
5G+行动为单个垂直行业提供通信和信息服务，边缘计算中引入区块链服务能够实现不同产业之间的协同，为垂直行业提供中立、可信、易用的“信息+信任”平台

## MEC（multi-access edge computing）多接入边缘计算

## 区块链+MEC部署三种模式
on-MEC 区块链部署在MEC资源池内
off-MEC 区块链部署在MEC资源池外
hybrid-MEC 混合部署

## 区块链+边缘计算的技术挑战
1.技术成熟度低
2.资源开销尚待降低
3.应用场景尚待扩展
4.安全威胁有待解决：传统安全威胁（DDoS，后门），区块链特有安全威胁（共识算法攻击、女巫攻击、分叉）

## 女巫攻击

网络中的少数节点控制多个虚假身份，利用身份控制网络中大量正常节点的攻击方式

# 区块链安全-详谈共识攻击
## 记账权力
比特币区块链通过竞争记账的方式解决去中心化的记账系统的一致性问题, 即以每个节点的计算能力即“算力”来竞争记账权的机制。
区块链的共识过程也就是我们所说的选择一个leader的过程，并且有这个领导人来进行新的区块的发布工作

## 区块的数学模型表示
我们将一个区块表示为包含三元组的数据 包 B = (h'，tx，nonce)，其中h' 是前一个区块的哈希， tx 是区块中所包含的交易记录，nonce 是一个 32 比特的整数
## pow攻击（proof of work，工作量证明）
### 双花攻击
双重花费
### 51%攻击
### 自私挖矿
矿工维护一个公开区块链，一个私密区块链。挖到区块后，首先添加到本地的私密区块链，而不是广播给其他矿工。此时，由于矿工已知上一个区块的值，可以先人一步进入下一个区块的计算。即使当前区块被人提前发了出来，也可将自己挖出的区块发到全网（公平竞争，被承认概率1/2）
只对pow有用
## pos（proof of stake，股权证明）
共识算法根据参与者持有股权比例，选出下一个leader。换句话说，持有资产越多的人，计算难度越低
优点：节约选出leader时需要的计算资源；贴近金融，有通胀情况产生
缺点：贫富不均；仍然需要哈希计算，故仍然存在计算资源浪费
伪代码
```
系统输入：tx、nonce、D

Pos过程：
1：nonce = 1（初值）
2：coins←accountBalance
3：age←currentTime-lashTransactionTime //币龄
4：while(H(nonce，tx，h') > = coins * age * D):
5：          nonce++
6：Broadcast( < nonce，tx，h' > )//广播计算的值
7：end
```
## dpos（delegated proof of stake，委托股权证明）
### 三种类型用户
**见证人**如同矿工，通过处理交易和维护区块链来获得报酬。而**代表**可以发起更新请求，但是他们并没有报酬。**工人**可以提出自己下一步的项目想法，如果此项目获得了大部分人的投票支持，那么他们会从中获得收益。
### 见证人选举
只有拥有被选举权的永久节点才能够被选举，最终只有前N名见证人可以被选举出来。这N个人都要获得50%以上的票数才能够顺利当选，除此之外，这个名单会按照固定的时间间隔进行重新选举。
### 见证人出快
见证人每生产一个块，都会获得报酬，他们的薪酬水平由其获得的投票决定。如果见证人没有生产区块，他们便没有收入，并且还有可能被 投票失去见证人的身份。
见证人生产区块时，每 2 s 生产一个区块，如果见 证人没有在规定的时间生产块，那么这个见证人将会
每2s需要产生一个区块，如果超过了规定的时间，那么当前见证人就会失去生产权利而转交给下一个人。
网络中所有的用户均有责任监控区块链生成的过程，并且同意需要选择分叉最长的那个链进行追加。
## 确定性共识算法面临的攻击
### 重放攻击
重放广播的区块，修改其中的交易部分
应对方法：
1.对于UTXO模型，我们需要对收到的交易检查其Hash是否存在。
2.对于Balance模型，我们需要防止随机数NONCE用以防止重放攻击。
3.时间戳
### 权力压迫攻击
攻击者在获得记账权的时候利用手中的部分权利实施一些操作让系统的随机数产生偏移用以增加自己下一次获得记账权力的可能性
1.验证者通过一些参数的组合找到一些特殊参数用以增加自己被选择的可能性。
2.利用对当前区块的控制力来影响下一个区块。

## 拜占庭将军问题
如何让众多完全平等的节点针对某一状态达成共识
### 拜占庭容错（Byzantine fault tolerance，BFT）
```
假设分布式节点存在3f+1个，最大恶意节点的容忍数量为f个，算法流程如下
1.客户端向主节点请求服务
2.主节点广播给副节点
3.副节点执行内容并反馈
4.客户端收到f+1个相同答案的数据
```
### 授权拜占庭容错（Delegated BFT, DBFT）
```
1获取议员名单：这种共识机制与议会制度十分相似，而每个区块的生成都是在议长的主持下由议会成员共同协商而生成的。
2确定议长：确定议长的算法是当前区块高度+1 再减去当前的视图编号，结果mod上当前的议员人数，结果就是议长的下标。
3议长发起共识：议长在更新完视图编号后，如果当前时间距离上次写入新区块的时间超过了预定的每轮共识的间隔时间（15s）则立即开始新一轮的共识，否则等到间隔时间后再发起共识。
4议员参与共识：当议长发起共识后会广播给议员节点，此时议员收到消息后对消息进行公钥验证，之后进行共识。
5视图更新：一个视图生存周期完成的时候，如果共识还没有被达成，则议员会发送广播请求进入下一个视图周期并重新选择议长，当请求更新视图的请求大于议员数量的2/3的时候，全网达成共识进入下一个视图周期重新开始共识过程。
```
与BFT相比
```
1将C/S架构的请求响应模式，改进为适合P2P网络的对等节点模式
2将静态的共识参与节点改进为可动态进入、退出的动态共识参与节点
3为共识参与节点的产生设计了一套基于持有权益比例的投票机制，通过投票决定共识参与节点（记账节点）
4在区块链中引入数字证书，解决了投票中对记账节点真实身份的认证问题
```
### DBFT安全隐患
主要由于时延产生

## 日蚀攻击
条件：P2P网络；40%算力
攻击原理未看懂
```

```
## 区块链贿赂攻击（Bribery attacks）
社会工程学，与具体技术无关
## 瑞波共识算法
三类节点：活跃信任节点、不活跃信任节点、验证节点
流程：①系统中客户端进行交易、②验证节点接收并存储交易、③信任节点发送提议于验证节点、④验证节点验证列表、⑤达成账本共识并关闭账本
安全性：BFT能力为$(n-1)/5$，即容许20%的节点出现拜占庭错误
## POET-消逝时间量证明
原理：以CPU为基本单位，随机产生一些延时，谁的延时最低，谁获得记账权（类似彩票算法）

## 长程攻击（Long-Range Attacks）

原理：攻击者创造一条从创世区块开始的长区块链分治，试图替换当前的合法主链。又称替换历史攻击或历史覆写攻击。

对象：针对PoS。由于PoS依据是无代价模拟的模式，因此几乎不需要消耗算力就可以创建一条从创世区块开始的长分支链。

具体攻击方法：简单攻击，变节攻击，权益流损，浪子漏洞，自杀漏洞

# 一文读懂区块链的共识机制

## PoW和PoS

PoW和PoS为抗女巫攻击的机制，PoW为算力投入，PoS为代币投入。

## 中本聪共识

当你看到提议的区块拥有最多工作量证明，就接受它

## 实用拜占庭容错算法 PBFT

让一组参与者进行多轮投票，知道一定比例的投票者达成共识

## 基于PoS的机制

选择某人提议区块，将区块发给其他参与者，由其他参与者进行投票

